<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Can&#39;t CoAP: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Can&#39;t CoAP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Can't CoAP Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Doxygen generated docs are here: <a href="http://staropram.github.io/cantcoap/index.html">http://staropram.github.io/cantcoap/index.html</a></p>
<h1>cantcoap</h1>
<p>CoAP implementation that focuses on simplicity by offering a minimal set of functions and straightforward interface.</p>
<div class="fragment"><div class="line"><a class="code" href="classCoapPDU.html">CoapPDU</a> *pdu = <span class="keyword">new</span> <a class="code" href="classCoapPDU.html">CoapPDU</a>();</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#a5aed3e2860acdd3beeac6a812fcf4700">setType</a>(CoapPDU::COAP_CONFIRMABLE);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#a45b63b94ede0981380517a08fbd52058" title="Sets the CoAP response code.">setCode</a>(CoapPDU::COAP_GET);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#adafa3fa099f4ba5248a05bb4a120bbed" title="Set the PDU token to the supplied byte sequence.">setToken</a>((uint8_t*)<span class="stringliteral">&quot;\3\2\1\0&quot;</span>,4);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#afd64c65662e72058abe6008a1abe08ec" title="Set messageID to the supplied value.">setMessageID</a>(0x0005);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#a5a53a8147901753189773d9eabe1d142" title="Shorthand function for setting a resource URI.">setURI</a>((<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;test&quot;</span>,4);</div>
<div class="line"></div>
<div class="line"><span class="comment">// send packet </span></div>
<div class="line">ret = send(sockfd,pdu-&gt;<a class="code" href="classCoapPDU.html#af02b5f6354c577957ab8a7fd307c11b1" title="Returns a pointer to the internal buffer.">getPDUPointer</a>(),pdu-&gt;<a class="code" href="classCoapPDU.html#a4bba97161bdc42ae88ff8787ca1779f0" title="Returns the length of the PDU.">getPDULength</a>(),0);</div>
</div><!-- fragment --><p>...</p>
<div class="fragment"><div class="line"><span class="comment">// receive packet</span></div>
<div class="line">ret = recvfrom(sockfd,&amp;buffer,BUF_LEN,0,(sockaddr*)&amp;recvAddr,&amp;recvAddrLen);</div>
<div class="line"><a class="code" href="classCoapPDU.html">CoapPDU</a> *recvPDU = <span class="keyword">new</span> <a class="code" href="classCoapPDU.html">CoapPDU</a>((uint8_t*)buffer,ret);</div>
<div class="line"><span class="keywordflow">if</span>(recvPDU-&gt;<a class="code" href="classCoapPDU.html#a757ad675b619f32b81c8c435792f4f9c" title="Validates a PDU constructed using an external buffer.">validate</a>()) {</div>
<div class="line">        recvPDU-&gt;<a class="code" href="classCoapPDU.html#ab84a11627b55810181d82b673d674468" title="Concatenates any URI_PATH elements into a single string.">getURI</a>(uriBuffer,URI_BUF_LEN,&amp;recvURILen);</div>
<div class="line">        ...</div>
<div class="line">}</div>
</div><!-- fragment --><h1>Compilation</h1>
<h2>Dependencies</h2>
<h3>CUnit</h3>
<p>See: <a href="http://cunit.sourceforge.net/">http://cunit.sourceforge.net/</a></p>
<p>This is a testing framework for c. On Debian based Linux you need libcunit1 and libcunit1-dev</p>
<h4>Debian (Ubuntu, Mint etc...)</h4>
<p>#apt-get update &amp;&amp; apt-get install libcunit1 libcunit1-dev</p>
<p>Or for newbie types:</p>
<p>$sudo apt-get update</p>
<p>$sudo apt-get install libcunit1 libcunit1-dev</p>
<h4>SuSE Linux - openSUSE 12.1 (x86_64)</h4>
<p>Note there is different package naming convention here for packages.</p>
<p>$sudo zypper install libcunit-dev</p>
<p>$sudo zypper install cunit-devel</p>
<h4>BSD</h4>
<p>Probably some variation, but for FreeBSD, CUnit is in the ports collection at /usr/ports/devel/cunit.</p>
<h2>Build</h2>
<p>Type make (Note, build with GNU make on BSD). This builds the test framework too. Type ./test to feel some misplaced confidence.</p>
<p>There is also an example client and server made. The server is supposed to work with the website coap.me, but isn't finished.</p>
<h1>Long description</h1>
<p>This is a CoAP implementation with a focus on simplicity. The library only provides PDU construction and de-construction.</p>
<p>The user is expected to deal with retransmissions, timeouts, and message ID matching themselves. This isn’t as arduous as it sounds and makes a lot more sense on a constrained device.</p>
<p>Imagine for example a simple microcontroller sensor that only reports readings once every 15 minutes, and only sends a few packets each time. Do you really need a complicated framework to deal with acknowledgements and re-transmissions?</p>
<p>Since CoAP recommends you only send one packet at at time, this means you only need to keep track of one on-going transaction at a time. Yeah... I think you’re capable of this.</p>
<p>Furthermore, the timers and interrupt processes between different embedded processor architectures, vary quite a bit. So it often makes sense to write the packet sending processes yourself.</p>
<p>Finally, you might be sending the packets over odd transport bearers such as a SMS (woah dude, that's just totally wild) or a simple radio bearer. In which case, it’s easiest to deal with buffers. If I built retransmission handlers, they’d all be UDP/IP specific and would bloat the code for no reason.</p>
<h1>Examples</h1>
<h2>Construction</h2>
<p>There are a couple of different ways to construct a PDU depending on whether you want the library to allocate memory for you, or whether you have an external buffer you want to use. You can also re-purpose existing objects.</p>
<h3>Using a managed object</h3>
<p>The simplest usage scenario hands control of memory allocation to the library:</p>
<div class="fragment"><div class="line"><a class="code" href="classCoapPDU.html">CoapPDU</a> *pdu = <span class="keyword">new</span> <a class="code" href="classCoapPDU.html">CoapPDU</a>();</div>
<div class="line">...</div>
<div class="line">pdu-&gt;setType(CoapPDU::COAP_CONFIRMABLE);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#a45b63b94ede0981380517a08fbd52058" title="Sets the CoAP response code.">setCode</a>(CoapPDU::COAP_GET);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,5,(uint8_t*)<span class="stringliteral">&quot;hello&quot;</span>);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,5,(uint8_t*)<span class="stringliteral">&quot;there&quot;</span>);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,6,(uint8_t*)<span class="stringliteral">&quot;server&quot;</span>);</div>
</div><!-- fragment --><p>In this case you just call the default constructor. That's it. The library handles memory from there-on out. For example, when adding each of those options, the library will realloc the pdu to accomodate space for them. It will also shrink the PDU if something changes (like the token length) so that it always uses the minimum amount of memory.</p>
<p>When you free the PDU, all data including the buffer is deleted. The PDU can also be reused as shown below.</p>
<h3>Using an external buffer for memory</h3>
<p>There are two obvious reasons why you would do this:</p>
<ol type="1">
<li>The buffer contains a CoAP PDU and you want to access the data in the PDU.</li>
<li>Buffers cost space and allocating memory consumes processor resources. On embedded targets it is often simpler to reuse buffers where possible.</li>
</ol>
<p>The first instance is a special case and requires some extra work. Just using an external buffer is as simple as follows:</p>
<div class="fragment"><div class="line">uint8_t *buffer[100];</div>
<div class="line"><a class="code" href="classCoapPDU.html">CoapPDU</a> *pdu = <span class="keyword">new</span> <a class="code" href="classCoapPDU.html">CoapPDU</a>((uint8_t*)buffer,100,0);</div>
<div class="line">...</div>
<div class="line">pdu-&gt;setType(CoapPDU::COAP_CONFIRMABLE);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#a45b63b94ede0981380517a08fbd52058" title="Sets the CoAP response code.">setCode</a>(CoapPDU::COAP_GET);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,5,(uint8_t*)<span class="stringliteral">&quot;hello&quot;</span>);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,5,(uint8_t*)<span class="stringliteral">&quot;there&quot;</span>);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,6,(uint8_t*)<span class="stringliteral">&quot;server&quot;</span>);</div>
</div><!-- fragment --><p>The PDU is constructed as normal except that the memory of your buffer is used instead of allocated memory.</p>
<p>A call such as this:</p>
<div class="fragment"><div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,5,(uint8_t*)<span class="stringliteral">&quot;hello&quot;</span>);</div>
</div><!-- fragment --><p>Will fail if there is no space left in the buffer.</p>
<p>When you delete the object, the buffer is not freed. Hey, it's your buffer mannn!</p>
<h3>Reusing an existing object</h3>
<p>Regardless of whether you constructed a PDU using either of the above methods, you can always reuse it:</p>
<div class="fragment"><div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#add695cf1e57cae13cfbfb9b6964a4456" title="Reset CoapPDU container so it can be reused to build a new PDU.">reset</a>(); </div>
<div class="line">...</div>
<div class="line">pdu-&gt;setType(CoapPDU::COAP_CONFIRMABLE);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#a45b63b94ede0981380517a08fbd52058" title="Sets the CoAP response code.">setCode</a>(CoapPDU::COAP_GET);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,5,(uint8_t*)<span class="stringliteral">&quot;hello&quot;</span>);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,5,(uint8_t*)<span class="stringliteral">&quot;there&quot;</span>);</div>
<div class="line">pdu-&gt;<a class="code" href="classCoapPDU.html#aab90c3016ce4eeb3b8580e43233e131f" title="Add an option to the PDU.">addOption</a>(11,6,(uint8_t*)<span class="stringliteral">&quot;server&quot;</span>);</div>
</div><!-- fragment --><p>The only difference is that if the PDU was initially constructed using managed-memory, then it will continue to have managed-memory. Whereas if the PDU was constructed with an external buffer, then you are limited in space by the size of the buffer you used.</p>
<h2>Receving CoAP packets over a network or something</h2>
<p>In this case you have a CoAP PDU in a buffer you just gobbled from a socket and want to read it:</p>
<div class="fragment"><div class="line">uint8_t *buffer[100];</div>
<div class="line"><span class="keywordtype">int</span> ret = recvfrom(sockfd,&amp;buffer,BUF_LEN,0,(sockaddr*)&amp;recvAddr,&amp;recvAddrLen);</div>
<div class="line"><a class="code" href="classCoapPDU.html">CoapPDU</a> *recvPDU = <span class="keyword">new</span> <a class="code" href="classCoapPDU.html">CoapPDU</a>((uint8_t*)buffer,ret,100);</div>
<div class="line"><span class="keywordflow">if</span>(recvPDU-&gt;<a class="code" href="classCoapPDU.html#a757ad675b619f32b81c8c435792f4f9c" title="Validates a PDU constructed using an external buffer.">validate</a>()) {</div>
<div class="line">        recvPDU-&gt;<a class="code" href="classCoapPDU.html#a0c0ba3c365647178f04e84c8e2412785" title="Prints the PDU in human-readable format.">printHuman</a>();</div>
<div class="line">        <span class="comment">// do your work</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>You must call <a class="el" href="classCoapPDU.html#a757ad675b619f32b81c8c435792f4f9c" title="Validates a PDU constructed using an external buffer.">CoapPDU::validate()</a> and get a positive response before accessing any of the data members. This sets up some internal pionters and so on, so if you fail to do it, undefined behaviour will result.</p>
<p>Note that the constructor is just a shorthand for the external-buffer-constructor explained above, and you can use the long form if you want. For example. you might want to use the long form if you have a buffer bigger than the PDU and you expect to reuse it.</p>
<p>You can reuse this object by resetting it as above.</p>
<p>If you reuse such an object, you need to set the PDU length manually because there is no way to deduce the PDU length using validate():</p>
<div class="fragment"><div class="line"><span class="comment">// earlier</span></div>
<div class="line"><span class="preprocessor">#define BUFLEN 500</span></div>
<div class="line"><span class="preprocessor"></span><span class="keywordtype">char</span> buffer[BUFLEN];</div>
<div class="line"><a class="code" href="classCoapPDU.html">CoapPDU</a> *recvPDU = <span class="keyword">new</span> <a class="code" href="classCoapPDU.html">CoapPDU</a>((uint8_t*)buffer,BUFLEN,BUFLEN);</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">while(1) {</div>
<div class="line">        <span class="comment">// receive packet</span></div>
<div class="line">        ret = sockfd,&amp;buffer,BUFLEN,0);</div>
<div class="line">        <span class="keywordflow">if</span>(ret==-1) {</div>
<div class="line">                INFO(<span class="stringliteral">&quot;Error receiving data&quot;</span>);</div>
<div class="line">                <span class="comment">// handle error</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// validate packet</span></div>
<div class="line">        <span class="comment">// you should also check that ret doesn&#39;t exceed buffer length</span></div>
<div class="line">        recvPDU-&gt;<a class="code" href="classCoapPDU.html#a1fb6272cbc6db25f00a86c496f32cc85" title="Set the PDU length to the length specified.">setPDULength</a>(ret);</div>
<div class="line">        <span class="keywordflow">if</span>(recvPDU-&gt;<a class="code" href="classCoapPDU.html#a757ad675b619f32b81c8c435792f4f9c" title="Validates a PDU constructed using an external buffer.">validate</a>()!=1) {</div>
<div class="line">                INFO(<span class="stringliteral">&quot;Malformed CoAP packet&quot;</span>);</div>
<div class="line">                <span class="comment">// handle error</span></div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 8 2013 15:30:59 for Can't CoAP by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
